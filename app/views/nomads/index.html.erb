<div id="map" style="width: 100%; height: 99vh;"></div>

<div class="nomad-count">
  <h1> <%= @nomads.count %> NOMADS </h1>
</div>


<!-- MAPS SCRIPT -->
<% content_for(:after_js) do %>

  <script src="<% asset_url('markerclusterer.js') %>"></script>

  <script>
    const mapContainer = document.querySelector('#map');
    const options = {
      zoom: 2,
      center: new google.maps.LatLng(<%= current_nomad.latitude %>, <%= current_nomad.longitude %>),
      styles: <%= render 'map_style.js' %>,
      scrollwheel: false
    };
    const nomads = [];

    function initMap() {
      const map = new google.maps.Map(mapContainer, options);

      // Populating the array with nomad objects
      <% @nomads.each do |nomad| %>
        var nomad = {
          id: <%= nomad.id %>,
          email: "<%= nomad.email %>",
          lat: <%= nomad.latitude %>,
          lgn: <%= nomad.longitude %>
        }
        nomads.push(nomad);
      <% end %>

      // Function to add a marker
      function addNomadMarker(object) {
        new google.maps.Marker({
          position: new google.maps.LatLng(object.lat, object.lgn),
          icon: '<%= image_url("icon.png") %>',
          map: map
        });
      };

      // Populating the map with markers
      const nomadMarkers = nomads.forEach( nomad => {
        addNomadMarker(nomad)
      });

      // Creating marker clusters
      const markerCluster = new MarkerClusterer(map, nomadMarkers, {
        imagePath: '../assets/markercluster'
        }
      );
    }

    document.addEventListener('DOMContentLoaded', initMap);
  </script>

<% end %>

<!-- https://chrome.google.com/webstore/detail/french-digital-nomads-map/aaokjnbicmobnkgjnmbmffbnldebhgfa -->
